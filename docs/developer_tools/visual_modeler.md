# Visual Data Modeler

The Uno Visual Data Modeler is a powerful tool for designing and generating domain entities, repositories, and services visually. It provides an interactive, browser-based interface for creating entity models and their relationships.

## Getting Started

### Prerequisites

Before using the visual modeler, ensure you have the following installed:

- Python 3.12+
- Uno framework
- FastAPI and Uvicorn (install with `pip install fastapi uvicorn`)
- Web browser with JavaScript enabled

### Launching the Modeler

To start the visual data modeler, run:

```bash
# Using the CLI directly
python -m uno.devtools.cli.main modeler start

# Or use the convenience script
./scripts/launch_modeler.sh
```

This will start the modeler server and automatically open your default web browser. By default, the server runs at http://localhost:8765.

### Command Line Options

The modeler command supports several options:

```bash
python -m uno.devtools.cli.main modeler start [OPTIONS]

Options:
  --host TEXT      Host to bind to (default: localhost)
  --port INTEGER   Port to bind to (default: 8765)
  --no-browser     Don't open browser automatically
  --project PATH   Project directory to analyze
```

## Using the Modeler

The visual modeler interface consists of several key components:

1. **Entity Canvas**: The main drawing area where entities and relationships are visualized
2. **Toolbar**: Contains controls for adding entities, relationships, and generating code
3. **Properties Panel**: Shows and allows editing of the selected entity or relationship
4. **Code View**: Displays the generated code for the model

### Creating Entities

To create a new entity:

1. Click the "Add Entity" button in the toolbar
2. Enter a name for your entity in the "New Entity" form
3. Click "Create" to add the entity to the canvas
4. The entity appears with default fields (id, created_at, updated_at)
5. Select the entity to edit its properties in the sidebar

### Defining Fields

Each entity can have multiple fields with different types. To add a field:

1. Select an entity to display its details in the sidebar
2. Click the "Add Field" button in the sidebar
3. Enter a field name
4. Select a field type from the dropdown (string, integer, float, boolean, datetime, etc.)
5. Set additional options like primary key and nullable attributes
6. Click "Add" to create the field

Fields can be managed in the entity details panel:
- View all fields in a list
- Delete fields using the delete button (primary key fields cannot be deleted)
- See field types and attributes at a glance

### Working with Relationships

The current version of the modeler displays relationships between entities. Future updates will include enhanced functionality for relationship creation and management.

Entities can be positioned by dragging them around the canvas:
1. Click and hold on an entity header to move it
2. Release to place the entity in its new position
3. Entities snap to a grid for clean alignment

### Managing Your Model

The modeler provides several model management features:

1. **Moving Entities**: Drag entities on the canvas to organize your model
2. **Selecting Entities**: Click on an entity to edit its properties
3. **Saving Models**: Click "Save Model" to download your model as a JSON file
4. **Model Persistence**: Your model is automatically saved in your browser session

### Generating Code

Once you've created your model, you can generate code:

1. Click the "Generate Code" button in the toolbar
2. The system processes your model and generates appropriate code
3. View the code in a dialog or copy it to your clipboard
4. Generated code includes entities, repositories, and services

The generated code follows Uno's architectural patterns and includes:

- Entity models with appropriate fields and relationships
- Repository interfaces and implementations
- Service classes with CRUD operations

## Analyzing Existing Projects

The modeler can also analyze existing projects to create visual models from code:

```bash
python -m uno.devtools.cli.main modeler analyze /path/to/project
```

This will scan the project directory for entities and generate a model representation. You can save this model to a file:

```bash
python -m uno.devtools.cli.main modeler analyze /path/to/project --output model.json
```

## Integration with Other Tools

### Using Generated Code with Scaffolding

The code generated by the visual modeler can be easily integrated with the scaffolding system:

1. Generate your domain model visually
2. Copy the generated entity code
3. Create a new feature using the scaffold command
4. Replace the generated entity file with your custom version

### AI-Enhanced Modeling

The visual modeler integrates with Uno's AI features:

1. The model analyzer uses AI to recognize entities and relationships in existing code
2. Code generation can be enhanced with AI suggestions for field types and validations
3. The modeling interface can suggest best practices for your domain model

## Advanced Features

### Custom Field Types

The modeler supports custom field types beyond the basic ones:

1. Select a field type of "relation" to create a relationship field
2. Use complex types like "array" or "json" for structured data
3. Define UUID fields for entity identification

### Batch Generation

You can generate code for multiple entities at once:

1. Create all your entities and relationships in the visual interface
2. Generate code with a single click
3. Review and copy code for all entities, repositories, and services

## Best Practices

When using the visual modeler, follow these best practices:

1. **Start Simple**: Begin with core entities and add complexity gradually
2. **Use Descriptive Names**: Choose clear names for entities and fields
3. **Define Relationships**: Always define relationships between related entities
4. **Review Generated Code**: Always review and understand the generated code before using it
5. **Iterate**: Use the modeler iteratively, refining your model as needed

## Troubleshooting

### Common Issues

- **Server Won't Start**: Ensure required dependencies are installed and no other service is using the same port
- **Entities Not Displaying**: Try refreshing the browser or restarting the server
- **Model Not Saving**: Ensure you have browser local storage enabled
- **Browser Compatibility**: The modeler works best with modern browsers (Chrome, Firefox, Edge)
- **Page Not Loading**: Check console for any JavaScript errors
- **Missing Icons/Styles**: Ensure your network can access the static assets

### Runtime Dependencies

The visual modeler depends on:
- FastAPI
- Uvicorn
- Jinja2 (for HTML templates)
- Web browser with JavaScript ES6+ support

### Getting Help

If you encounter issues:

1. Check the server console for error messages
2. Use the `--help` option for command usage information
3. Inspect the browser console for client-side errors
4. Check that port 8765 (or your configured port) is available
5. Refer to the Uno documentation for more detailed information

## Examples

### Simple CRUD Model

Here's an example of a basic CRUD model with two entities:

1. Create a `Product` entity with:
   - `id` (uuid, primary key)
   - `name` (string)
   - `description` (string)
   - `price` (float)
   - `created_at` (datetime)
   - `updated_at` (datetime)

2. Create a `Category` entity with:
   - `id` (uuid, primary key)
   - `name` (string)
   - `description` (string)

3. Create a one-to-many relationship from `Category` to `Product`

4. Generate code to get complete entity, repository, and service implementations

### Domain-Driven Design Example

For a more complex domain model:

1. Create aggregate root entities like `Order` and `Customer`
2. Create value objects as entities with appropriate fields
3. Define relationships based on domain rules (ownership, composition, etc.)
4. Generate code and enhance with domain-specific logic